<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>foo</title>
<script language="javascript" src="src/utils.js"></script>
<script language="javascript" src="src/const.js"></script>
<script language="javascript" src="src/tilemap.js"></script>
<script language="javascript" src="src/actor.js"></script>
<script language="javascript" src="src/scene.js"></script>
<script language="javascript" src="src/game.js"></script>
<script language="javascript">
function run()
{
  function getprops(a) {
    var d = {};
    for (var i = 0; i < a.length; i++) { d[a[i].id] = a[i]; }
    return d;
  }
  var framerate = 30;
  var images = getprops(document.getElementsByTagName('img'));
  var audios = getprops(document.getElementsByTagName('audio'));
  var labels = getprops(document.getElementsByClassName('label'));
  var canvas = document.getElementById('canvas');
  var ctx = canvas.getContext('2d');
  var game = new Game(framerate, canvas, images, audios, labels);
  function idle() {
    if (game.active) {
      game.idle();
      game.repaint(ctx);
    }
  };
  function keydown(e) {
    if (game.active) {
      game.keydown(e);
      switch (e.keyCode) {
      case 32:
      case 37:
      case 38:
      case 39:
      case 40:
	e.preventDefault();
	break;
      }
    }
  };
  function keyup(e) {
    if (game.active) {
      game.keyup(e);
    }
  };
  function focus(e) {
    if (!game.active) {
      game.focus(e);
      game.repaint(ctx);
    }
  };
  function blur(e) {
    if (game.active) {
      game.blur(e);
      game.repaint(ctx);
    }
  };
  window.addEventListener('keydown', keydown);
  window.addEventListener('keyup', keyup);
  window.addEventListener('focus', focus);
  window.addEventListener('blur', blur);
  game.init();
  canvas.focus();
  window.setInterval(idle, 1000/framerate);
}
</script>
<body onload="run();">
<div align=center>
  <div style="position:relative;">
    <canvas id="canvas" 
	    style="position:absolute; top:0; left:0; background:gray;"
	    width="320" height="240"></canvas>
    <div class="label" id="score" 
	 style="position:absolute; top:10px; left:10px; color:white;">Score: 0</div>
  </div>
</div>
<div style="display:none;">
  <img id="tiles" src="assets/tiles.png">
  <img id="sprites" src="assets/sprites.png">
  <audio id="jump" type="audio/mpeg" src="assets/jump.mp3" preload="auto"></audio>
  <audio id="pick" type="audio/mpeg" src="assets/pick.mp3" preload="auto"></audio>
  <audio id="music" type="audio/mpeg" src="assets/music.mp3" loop="true" preload="auto"></audio>
</div>
</body>
