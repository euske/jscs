<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>foo</title>
<script language="javascript" src="src/utils.js"></script>
<script language="javascript" src="src/tilemap.js"></script>
<script language="javascript" src="src/game.js"></script>
<script language="javascript">
function run()
{
  function getprops(a) {
    var d = {};
    for (var i = 0; i < a.length; i++) { d[a[i].id] = a[i]; }
    return d;
  }
  var images = getprops(document.getElementsByTagName('img'));
  var audios = getprops(document.getElementsByTagName('audio'));
  var canvas = document.getElementById('canvas');
  var label = document.getElementById('label');
  var ctx = canvas.getContext('2d');
  var game = new Game(canvas, images, audios, label);
  var dt = 1000/30;
  function idle() {
    if (game.active) {
      game.idle();
      game.repaint(ctx);
    }
    window.setTimeout(idle, dt);
  };
  window.setTimeout(idle, dt);
  window.addEventListener('keydown', function (e) { game.keydown(e); });
  window.addEventListener('keyup', function (e) { game.keyup(e); });
  window.addEventListener('focus', function (e) { game.focus(e); game.repaint(ctx); });
  window.addEventListener('blur', function (e) { game.blur(e); game.repaint(ctx); });
  game.init();
}
</script>
<body onload="run();">
<div align=center>
  <canvas id="canvas" style="position:absolute; top:0; left:0; background:gray;" width="640" height="480"></canvas>
  <div id="label" style="position:absolute; top:0; left:0; color:white;">Score: 0</div>
  <img id="tiles" src="assets/tiles.png" style="display:none;">
  <img id="sprites" src="assets/sprites.png" style="display:none;">
  <audio id="jump" type="audio/mpeg" src="assets/jump.mp3" preload="auto"></audio>
  <audio id="pick" type="audio/mpeg" src="assets/pick.mp3" preload="auto"></audio>
  <audio id="music" type="audio/mpeg" src="assets/music.mp3" loop="true" preload="auto"></audio>
</div>
</body>
